import{a as U}from"./chunk-JY5FCQNE.js";import{a as Q,b as X}from"./chunk-6R42RFTB.js";import{$a as B,Bb as G,J as L,K as V,Ka as v,La as O,Ma as u,Na as j,Oa as $,Pa as a,Qa as i,Ra as P,Sa as T,Ta as S,Ua as g,X as D,Ya as r,Za as x,_a as _,a as w,b as I,bb as z,db as M,ea as b,fa as y,fb as C,ga as E,ha as R,i as F,wa as o,xa as A,xb as H,yb as N}from"./chunk-XZU32RY2.js";function W(s,h){if(s&1){let e=T();a(0,"button",26),S("click",function(){let n=b(e).$implicit,c=g(2);return y(c.setMetric(n.key))}),r(1),i()}if(s&2){let e=h.$implicit,t=g(2);$("active",e.key===t.selectedMetric),o(),_(" ",e.label," ")}}function Z(s,h){if(s&1&&(E(),P(0,"circle",27)),s&2){let e=g(2);O("cx",e.hoverPoint.x)("cy",e.hoverPoint.y)}}function ee(s,h){if(s&1&&(a(0,"div",28),r(1),i()),s&2){let e=g(2);o(),_(" ",e.hoverLabel()," ")}}function te(s,h){if(s&1&&(a(0,"li"),r(1),i()),s&2){let e=h.$implicit;o(),x(e)}}function ne(s,h){if(s&1&&(a(0,"div",29)(1,"div",30)(2,"span"),r(3),i(),a(4,"strong"),r(5),i()(),a(6,"div",31),P(7,"span"),i()()),s&2){let e=h.$implicit;o(3),x(e.label),o(2),_("",e.value,"%"),o(2),j("width",e.bar,"%")}}function ie(s,h){if(s&1){let e=T();a(0,"section",1)(1,"header",2)(2,"div")(3,"h1"),r(4,"Analytics"),i(),a(5,"p"),r(6,"Trendlines across traffic, newsletters, and voucher conversions."),i()(),a(7,"app-date-range-selector",3),S("select",function(n){b(e);let c=g();return y(c.setRange(n))}),i()(),a(8,"section",4)(9,"div",5),v(10,W,2,3,"button",6),i(),a(11,"button",7),S("click",function(){b(e);let n=g();return y(n.toggleSmoothing())}),r(12),i()(),a(13,"section",8)(14,"div")(15,"span"),r(16,"Total"),i(),a(17,"strong"),r(18),M(19,"number"),i(),a(20,"p"),r(21),i()(),a(22,"div")(23,"span"),r(24,"Average"),i(),a(25,"strong"),r(26),M(27,"number"),i(),a(28,"p"),r(29,"Per day"),i()(),a(30,"div")(31,"span"),r(32,"Peak"),i(),a(33,"strong"),r(34),M(35,"number"),i(),a(36,"p"),r(37,"Highest day"),i()(),a(38,"div")(39,"span"),r(40,"Momentum"),i(),a(41,"strong"),r(42),M(43,"number"),i(),a(44,"p"),r(45),i()()(),a(46,"section",9)(47,"div",10)(48,"div")(49,"h3"),r(50),i(),a(51,"span",11),r(52,"Hover to explore daily values"),i()(),a(53,"div",12),r(54),M(55,"number"),i()(),a(56,"div",13),E(),a(57,"svg",14),S("mousemove",function(n){b(e);let c=g();return y(c.onMove(n))})("mouseleave",function(){b(e);let n=g();return y(n.clearHover())}),a(58,"defs")(59,"linearGradient",15),P(60,"stop",16)(61,"stop",17),i()(),P(62,"polyline",18)(63,"polyline",19),v(64,Z,1,2,"circle",20),i(),v(65,ee,2,1,"div",21),i()(),R(),a(66,"section",22)(67,"div",23)(68,"h3"),r(69,"Quick insights"),i(),a(70,"ul"),v(71,te,2,1,"li",24),i()(),a(72,"div",23)(73,"h3"),r(74,"Category breakdown"),i(),v(75,ne,8,4,"div",25),i()()()}if(s&2){let e=g();o(7),u("options",e.ranges)("selected",e.selectedRange),o(3),u("ngForOf",e.metrics),o(2),_(" ",e.smoothing?"Disable smoothing":"Enable smoothing"," "),o(6),x(C(19,21,e.stats.total,"1.0-0")),o(3),x(e.selectedMetricUnit),o(5),x(C(27,24,e.stats.avg,"1.1-1")),o(8),x(C(35,27,e.stats.peak,"1.1-1")),o(8),_("",C(43,30,e.stats.trend,"1.1-1"),"%"),o(3),x(e.stats.trend>=0?"Growing":"Cooling off"),o(5),_("",e.selectedMetricLabel," pulse"),o(3),$("positive",e.stats.change>=0),o(),B(" 7-day ",e.stats.change>=0?"lift":"dip"," ",C(55,33,e.stats.change,"1.1-1"),"% "),o(8),O("points",e.chartArea),o(),O("points",e.chartPath),o(),u("ngIf",e.hoverPoint),o(),u("ngIf",e.hoverIndex>=0),o(6),u("ngForOf",e.insights),o(4),u("ngForOf",e.breakdownRows)}}var Y=(()=>{class s{constructor(e,t){this.api=e,this.state=t,this.destroy$=new F,this.ranges=this.getRanges(),this.selectedRange=this.ranges[0],this.selectedMetric="traffic",this.smoothing=!0,this.hoverIndex=-1,this.metrics=[{key:"traffic",label:"Traffic",unit:"sessions"},{key:"newsletter",label:"Newsletter",unit:"open %"},{key:"vouchers",label:"Vouchers",unit:"conversion %"}]}ngOnInit(){this.state.dateRange$.pipe(L(e=>(this.selectedRange=e,this.api.getAnalytics(e.from,e.to))),V(this.destroy$)).subscribe(e=>this.analytics=e)}setRange(e){this.state.setDateRange(e)}setMetric(e){this.selectedMetric=e,this.hoverIndex=-1}toggleSmoothing(){this.smoothing=!this.smoothing}get selectedMetricLabel(){return this.metrics.find(e=>e.key===this.selectedMetric)?.label??""}get selectedMetricUnit(){return this.metrics.find(e=>e.key===this.selectedMetric)?.unit??""}get points(){if(!this.analytics)return[];let e=this.analytics[this.selectedMetric];return this.smoothing?this.applyMovingAverage(e,3):e}get stats(){let e=this.points.map(d=>d.value);if(!e.length)return{total:0,avg:0,peak:0,trend:0,change:0};let t=e.reduce((d,m)=>d+m,0),n=t/e.length,c=Math.max(...e),p=(e[e.length-1]-e[0])/(e[0]||1)*100,l=this.compareLastPeriods(e,7);return{total:t,avg:n,peak:c,trend:p,change:l}}get insights(){let e=this.stats,t=e.trend>=0?"up":"down",n=e.change>=0?"lift":"dip";return[`${this.selectedMetricLabel} trend is ${t} ${Math.abs(e.trend).toFixed(1)}% across the range.`,`Last 7-day average shows a ${n} of ${Math.abs(e.change).toFixed(1)}%.`,`Peak day hit ${e.peak.toFixed(1)} \u2014 consider boosting that slot with promos.`]}get chartPath(){return this.buildPath(this.points,320,120).line}get chartArea(){return this.buildPath(this.points,320,120).area}get hoverPoint(){if(this.hoverIndex<0||this.hoverIndex>=this.points.length)return null;let e=this.points.map(l=>l.value),t=Math.max(...e),n=Math.min(...e),c=this.hoverIndex/(this.points.length-1)*320,p=120-(this.points[this.hoverIndex].value-n)/(t-n||1)*104-8;return{x:c,y:p}}hoverLabel(){if(this.hoverIndex<0||this.hoverIndex>=this.points.length)return"";let e=this.points[this.hoverIndex],t=new Date(e.date);return`${this.selectedMetricLabel} \xB7 ${t.toLocaleDateString()} \xB7 ${e.value.toFixed(1)}`}onMove(e){let n=e.currentTarget.getBoundingClientRect(),c=e.clientX-n.left,p=Math.round(c/n.width*(this.points.length-1));this.hoverIndex=Math.max(0,Math.min(p,this.points.length-1))}clearHover(){this.hoverIndex=-1}get breakdownRows(){if(!this.analytics)return[];let e=this.analytics.breakdown.reduce((t,n)=>t+n.value,0)||1;return this.analytics.breakdown.map(t=>I(w({},t),{bar:Math.round(t.value/e*100)})).sort((t,n)=>n.value-t.value)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}applyMovingAverage(e,t){return e.map((n,c)=>{let p=Math.max(0,c-t+1),l=e.slice(p,c+1),d=l.reduce((m,k)=>m+k.value,0)/l.length;return I(w({},n),{value:Number(d.toFixed(2))})})}compareLastPeriods(e,t){if(e.length<t*2)return 0;let n=e.slice(-t),c=e.slice(-t*2,-t),p=n.reduce((d,m)=>d+m,0)/t,l=c.reduce((d,m)=>d+m,0)/t;return(p-l)/(l||1)*100}buildPath(e,t,n){if(!e.length)return{line:"",area:""};let c=e.map(f=>f.value),p=Math.max(...c),l=Math.min(...c),m=e.map((f,q)=>{let J=q/(e.length-1)*t,K=n-(f.value-l)/(p-l||1)*(n-16)-8;return{x:J,y:K}}).map(f=>`${f.x},${f.y}`).join(" "),k=`0,${n} ${m} ${t},${n}`;return{line:m,area:k}}getRanges(){let e=new Date;return[7,30,90].map(t=>{let n=new Date;return n.setDate(e.getDate()-t),{label:`Last ${t} days`,from:n.toISOString(),to:e.toISOString()}})}static{this.\u0275fac=function(t){return new(t||s)(A(Q),A(X))}}static{this.\u0275cmp=D({type:s,selectors:[["app-analytics"]],standalone:!0,features:[z],decls:1,vars:1,consts:[["class","analytics",4,"ngIf"],[1,"analytics"],[1,"header"],[3,"select","options","selected"],[1,"controls"],[1,"metric-tabs"],["type","button",3,"active","click",4,"ngFor","ngForOf"],["type","button",1,"ghost",3,"click"],[1,"stats"],[1,"chart-panel"],[1,"chart-header"],[1,"muted"],[1,"pill"],[1,"chart"],["viewBox","0 0 320 120",3,"mousemove","mouseleave"],["id","area","x1","0","x2","0","y1","0","y2","1"],["offset","0%","stop-color","var(--accent)","stop-opacity","0.35"],["offset","100%","stop-color","var(--accent)","stop-opacity","0"],["fill","url(#area)"],["fill","none","stroke","var(--accent)","stroke-width","2.5"],["r","4","fill","var(--accent-strong)",4,"ngIf"],["class","tooltip",4,"ngIf"],[1,"insights"],[1,"panel"],[4,"ngFor","ngForOf"],["class","breakdown",4,"ngFor","ngForOf"],["type","button",3,"click"],["r","4","fill","var(--accent-strong)"],[1,"tooltip"],[1,"breakdown"],[1,"label"],[1,"bar"]],template:function(t,n){t&1&&v(0,ie,76,36,"section",0),t&2&&u("ngIf",n.analytics)},dependencies:[H,N,G,U],styles:[".analytics[_ngcontent-%COMP%]{display:grid;gap:24px}.header[_ngcontent-%COMP%], .controls[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:16px;flex-wrap:wrap}.metric-tabs[_ngcontent-%COMP%]{display:flex;gap:8px;flex-wrap:wrap}.metric-tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:1px solid var(--border);background:var(--surface-strong);padding:8px 14px;border-radius:999px;color:var(--text-secondary)}.metric-tabs[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background:var(--accent);color:#fff;border-color:var(--accent)}.ghost[_ngcontent-%COMP%]{border:1px solid var(--border);background:var(--surface-strong);padding:8px 16px;border-radius:999px}.stats[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px}.stats[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{background:var(--surface-strong);border-radius:18px;padding:16px;border:1px solid var(--border);box-shadow:var(--shadow)}.stats[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .stats[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-tertiary);font-size:.8rem}.chart-panel[_ngcontent-%COMP%]{background:var(--surface-strong);border-radius:22px;padding:20px;border:1px solid var(--border);box-shadow:var(--shadow);display:grid;gap:16px}.chart-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:12px}.chart[_ngcontent-%COMP%]{position:relative}.chart[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:100%;height:160px}.tooltip[_ngcontent-%COMP%]{position:absolute;top:12px;right:12px;background:var(--surface-muted);padding:6px 10px;border-radius:10px;font-size:.75rem;color:var(--text-secondary)}.pill[_ngcontent-%COMP%]{padding:6px 12px;border-radius:999px;background:var(--danger-soft);color:var(--danger);font-size:.75rem}.pill.positive[_ngcontent-%COMP%]{background:var(--success-soft);color:var(--success)}.insights[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px}.panel[_ngcontent-%COMP%]{background:var(--surface-strong);border-radius:22px;padding:18px;border:1px solid var(--border);box-shadow:var(--shadow)}.panel[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:0;padding-left:18px;display:grid;gap:8px;color:var(--text-secondary)}.breakdown[_ngcontent-%COMP%]{display:grid;gap:6px;padding:10px 0}.label[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:.85rem}.bar[_ngcontent-%COMP%]{height:8px;background:var(--surface-muted);border-radius:999px;overflow:hidden}.bar[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block;height:100%;background:linear-gradient(90deg,var(--accent),var(--accent-strong))}.muted[_ngcontent-%COMP%]{color:var(--text-tertiary);font-size:.8rem}"]})}}return s})();var he=[{path:"",component:Y}];export{he as ANALYTICS_ROUTES};
