import{c as J,e as K,f as Q}from"./chunk-O7K5DKLK.js";import{a as D,b as Y}from"./chunk-6R42RFTB.js";import{a as b,b as y,c as C,d as S,e as W,f as X,g as M,j as E,k as _,l as O,m as w,n as V,p as P}from"./chunk-GUREU6BF.js";import{$a as j,Ab as U,Bb as H,J as A,K as m,Ka as x,Ma as l,Oa as T,Pa as t,Qa as r,Ra as c,Ta as R,X as u,Ya as i,Za as p,_a as $,a as f,b as g,bb as v,cb as B,db as I,eb as G,fb as z,i as h,wa as s,xa as d,xb as q,yb as L}from"./chunk-XZU32RY2.js";var ee=(()=>{class o{constructor(){this.label="",this.active=!1}static{this.\u0275fac=function(n){return new(n||o)}}static{this.\u0275cmp=u({type:o,selectors:[["app-status-badge"]],inputs:{label:"label",active:"active"},standalone:!0,features:[v],decls:2,vars:3,consts:[[1,"badge"]],template:function(n,a){n&1&&(t(0,"span",0),i(1),r()),n&2&&(T("is-active",a.active),s(),p(a.label))},styles:[".badge[_ngcontent-%COMP%]{padding:4px 10px;border-radius:999px;font-size:.75rem;background:var(--surface);border:1px solid var(--border);color:var(--text-secondary)}",".badge.is-active[_ngcontent-%COMP%]{background:var(--success-soft);border-color:var(--success);color:var(--success)}"]})}}return o})();var ne=o=>["/vouchers",o,"edit"];function oe(o,N){if(o&1&&(t(0,"div",15)(1,"strong"),i(2),r(),t(3,"span"),i(4),r(),t(5,"span"),i(6),I(7,"date"),r(),c(8,"app-status-badge",16),t(9,"span"),i(10),r(),t(11,"a",17),i(12,"Edit"),r()()),o&2){let e=N.$implicit;s(2),p(e.merchant),s(2),p(e.code),s(2),p(z(7,8,e.expiryDate,"MMM d, y")),s(2),l("label",e.active?"Active":"Paused")("active",e.active),s(2),j("",e.clicks," clicks \xB7 ",e.conversions," conv"),s(),l("routerLink",B(11,ne,e.id))}}var te=(()=>{class o{constructor(e,n,a){this.api=e,this.state=n,this.fb=a,this.destroy$=new h,this.vouchers=[],this.filters=this.fb.group({merchant:[""],active:["true"],sort:["expiryDate:asc"]})}get totalClicks(){return this.vouchers.reduce((e,n)=>e+n.clicks,0)}get totalConversions(){return this.vouchers.reduce((e,n)=>e+n.conversions,0)}get totalRevenue(){return this.vouchers.reduce((e,n)=>e+n.revenue,0)}ngOnInit(){this.filters.valueChanges.pipe(m(this.destroy$)).subscribe(e=>{this.state.updateVoucherTableState({sort:e.sort??"expiryDate:asc",filters:{merchant:e.merchant??"",active:e.active==="true"}})}),this.state.voucherTableState$.pipe(A(e=>this.api.getVouchers(g(f({},e.filters),{page:e.page,pageSize:e.pageSize,sort:e.sort}))),m(this.destroy$)).subscribe(e=>this.vouchers=e)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static{this.\u0275fac=function(n){return new(n||o)(d(D),d(Y),d(V))}}static{this.\u0275cmp=u({type:o,selectors:[["app-vouchers"]],standalone:!0,features:[v],decls:52,vars:7,consts:[[1,"vouchers"],[1,"header"],["routerLink","/vouchers/new",1,"primary"],[1,"metrics"],[1,"filters",3,"formGroup"],["type","search","formControlName","merchant","placeholder","Merchant"],["formControlName","active"],["value","true"],["value","false"],["formControlName","sort"],["value","expiryDate:asc"],["value","revenue:desc"],[1,"table"],[1,"table-row","header"],["class","table-row",4,"ngFor","ngForOf"],[1,"table-row"],[3,"label","active"],[3,"routerLink"]],template:function(n,a){n&1&&(t(0,"section",0)(1,"header",1)(2,"div")(3,"h1"),i(4,"Vouchers & Affiliate"),r(),t(5,"p"),i(6,"Monitor merchant performance and manage voucher inventory."),r()(),t(7,"a",2),i(8,"New Voucher"),r()(),t(9,"section",3)(10,"div")(11,"span"),i(12,"Total Clicks"),r(),t(13,"strong"),i(14),r()(),t(15,"div")(16,"span"),i(17,"Conversions"),r(),t(18,"strong"),i(19),r()(),t(20,"div")(21,"span"),i(22,"Revenue"),r(),t(23,"strong"),i(24),I(25,"number"),r()()(),t(26,"section",4),c(27,"input",5),t(28,"select",6)(29,"option",7),i(30,"Active"),r(),t(31,"option",8),i(32,"Inactive"),r()(),t(33,"select",9)(34,"option",10),i(35,"Expiry soonest"),r(),t(36,"option",11),i(37,"Top revenue"),r()()(),t(38,"section",12)(39,"div",13)(40,"span"),i(41,"Merchant"),r(),t(42,"span"),i(43,"Code"),r(),t(44,"span"),i(45,"Expiry"),r(),t(46,"span"),i(47,"Status"),r(),t(48,"span"),i(49,"Performance"),r(),c(50,"span"),r(),x(51,oe,13,13,"div",14),r()()),n&2&&(s(14),p(a.totalClicks),s(5),p(a.totalConversions),s(5),$("\xA3",G(25,5,a.totalRevenue),""),s(2),l("formGroup",a.filters),s(25),l("ngForOf",a.vouchers))},dependencies:[P,O,w,b,_,C,S,M,E,q,U,H,Q,ee],styles:[".vouchers[_ngcontent-%COMP%]{display:grid;gap:24px}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:16px;flex-wrap:wrap}.primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,var(--accent),var(--accent-strong));color:#fff;padding:8px 16px;border-radius:999px;text-decoration:none;box-shadow:var(--shadow)}.metrics[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px}.metrics[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{background:var(--surface-strong);padding:16px;border-radius:18px;border:1px solid var(--border);display:grid;gap:6px;box-shadow:var(--shadow)}.metrics[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--text-tertiary);font-size:.8rem}.filters[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr repeat(2,minmax(160px,1fr));gap:12px}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{border:1px solid var(--border);padding:10px 12px;border-radius:12px;background:var(--surface-strong);color:var(--text-primary)}.table[_ngcontent-%COMP%]{border-radius:22px;border:1px solid var(--border);overflow:hidden;box-shadow:var(--shadow)}.table-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1.2fr 1fr 1fr 1fr 1.4fr auto;align-items:center;padding:12px 16px;background:var(--surface-strong);border-bottom:1px solid var(--border);transition:background .2s ease}.table-row[_ngcontent-%COMP%]:hover{background:var(--surface-muted)}.table-row.header[_ngcontent-%COMP%]{background:var(--surface-muted);color:var(--text-secondary);font-weight:600}.table-row[_ngcontent-%COMP%]:last-child{border-bottom:none}@media (max-width: 900px){.filters[_ngcontent-%COMP%]{grid-template-columns:1fr}.table-row[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:8px}}"]})}}return o})();function ae(o,N){o&1&&(t(0,"div",12),i(1," Expiry date must be in the future. "),r())}var k=(()=>{class o{constructor(e,n,a,F){this.fb=e,this.api=n,this.route=a,this.router=F,this.destroy$=new h,this.form=this.fb.group({merchant:["",y.required],code:["",y.required],active:[!0],expiryDate:["",[y.required,this.futureDateValidator]],clicks:[0],conversions:[0],revenue:[0]})}ngOnInit(){this.voucherId=this.route.snapshot.paramMap.get("id")??void 0,this.voucherId&&this.api.getVouchers({page:1,pageSize:20,sort:"expiryDate:asc"}).pipe(m(this.destroy$)).subscribe(e=>{let n=e.find(a=>a.id===this.voucherId);n&&this.form.patchValue(g(f({},n),{expiryDate:new Date(n.expiryDate).toISOString().slice(0,10)}))})}save(){if(this.form.invalid){this.form.markAllAsTouched();return}let e=this.form.getRawValue();(this.voucherId?this.api.updateVoucher(this.voucherId,e):this.api.createVoucher(e)).pipe(m(this.destroy$)).subscribe(()=>this.router.navigate(["/vouchers"]))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}futureDateValidator(e){let n=e.value;return n&&new Date(n).getTime()<=Date.now()?{expiryDate:!0}:null}static{this.\u0275fac=function(n){return new(n||o)(d(V),d(D),d(J),d(K))}}static{this.\u0275cmp=u({type:o,selectors:[["app-voucher-form"]],standalone:!0,features:[v],decls:35,vars:5,consts:[[1,"form"],[3,"ngSubmit","formGroup"],["type","text","formControlName","merchant"],["type","text","formControlName","code"],["formControlName","active"],[3,"ngValue"],["type","date","formControlName","expiryDate"],["class","error",4,"ngIf"],["type","number","formControlName","clicks"],["type","number","formControlName","conversions"],["type","number","formControlName","revenue"],["type","submit",1,"primary"],[1,"error"]],template:function(n,a){n&1&&(t(0,"section",0)(1,"header")(2,"h1"),i(3),r(),t(4,"p"),i(5,"Manage voucher metadata and validate expiry timing."),r()(),t(6,"form",1),R("ngSubmit",function(){return a.save()}),t(7,"label"),i(8," Merchant "),c(9,"input",2),r(),t(10,"label"),i(11," Code "),c(12,"input",3),r(),t(13,"label"),i(14," Active "),t(15,"select",4)(16,"option",5),i(17,"Active"),r(),t(18,"option",5),i(19,"Paused"),r()()(),t(20,"label"),i(21," Expiry Date "),c(22,"input",6),r(),x(23,ae,2,0,"div",7),t(24,"label"),i(25," Clicks "),c(26,"input",8),r(),t(27,"label"),i(28," Conversions "),c(29,"input",9),r(),t(30,"label"),i(31," Revenue "),c(32,"input",10),r(),t(33,"button",11),i(34,"Save Voucher"),r()()()),n&2&&(s(3),p(a.voucherId?"Edit Voucher":"Create Voucher"),s(3),l("formGroup",a.form),s(10),l("ngValue",!0),s(2),l("ngValue",!1),s(5),l("ngIf",a.form.controls.expiryDate.touched&&a.form.controls.expiryDate.errors))},dependencies:[P,W,O,w,b,X,_,C,S,M,E,L],styles:[".form[_ngcontent-%COMP%]{display:grid;gap:20px;max-width:640px}form[_ngcontent-%COMP%]{display:grid;gap:12px;background:var(--surface-strong);border-radius:20px;padding:20px;border:1px solid var(--border)}label[_ngcontent-%COMP%]{display:grid;gap:6px;font-size:.85rem;color:var(--text-secondary)}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{border:1px solid var(--border);border-radius:12px;padding:10px 12px;background:var(--surface);color:var(--text-primary)}.primary[_ngcontent-%COMP%]{background:var(--accent);color:#fff;border:none;padding:10px 16px;border-radius:999px}.error[_ngcontent-%COMP%]{color:var(--danger);font-size:.8rem}"]})}}return o})();var Ee=[{path:"",component:te},{path:"new",component:k},{path:":id/edit",component:k}];export{Ee as VOUCHER_ROUTES};
