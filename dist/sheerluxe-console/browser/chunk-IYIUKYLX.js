import{c as R,e as A,f as B}from"./chunk-N66UAEQX.js";import{a as Z,b as ee}from"./chunk-TNFIVIDD.js";import{a as v,b as te}from"./chunk-7DQOHWYX.js";import{a as L,b as _,c as G,d as U,e as V,g as z,h as q,i as H,j as W,k as J,l as K,m as Q,n as X,p as Y}from"./chunk-VVZIR6GQ.js";import{$a as h,Da as E,Ja as g,K as m,La as l,Na as n,O as I,Oa as t,Pa as x,Ra as S,Sa as y,Wa as r,X as f,Xa as d,Ya as b,ab as F,bb as D,db as j,i as u,mb as O,r as P,va as s,vb as C,wa as p,wb as T,yb as $}from"./chunk-SFTGCUHE.js";var se=i=>["/newsletter/preview",i];function le(i,c){if(i&1&&(n(0,"div",8)(1,"strong"),r(2),t(),n(3,"span"),r(4),t(),n(5,"span"),r(6),D(7,"date"),t(),n(8,"a",9),r(9,"Preview"),t()()),i&2){let e=c.$implicit;s(2),d(e.subject),s(2),d(e.status),s(2),d(j(7,4,e.sendDate,"MMM d, y")),s(2),l("routerLink",F(7,se,e.id))}}var ne=(()=>{class i{constructor(e){this.api=e,this.destroy$=new u,this.newsletters=[]}ngOnInit(){this.api.getNewsletters({status:"scheduled",page:1,pageSize:10}).pipe(m(this.destroy$)).subscribe(e=>this.newsletters=e)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static{this.\u0275fac=function(o){return new(o||i)(p(v))}}static{this.\u0275cmp=f({type:i,selectors:[["app-newsletter-list"]],standalone:!0,features:[h],decls:22,vars:1,consts:[[1,"newsletter"],[1,"header"],[1,"actions"],["routerLink","/newsletter/builder",1,"primary"],["routerLink","/newsletter/analytics",1,"ghost"],[1,"table"],[1,"table-row","header"],["class","table-row",4,"ngFor","ngForOf"],[1,"table-row"],[3,"routerLink"]],template:function(o,a){o&1&&(n(0,"section",0)(1,"header",1)(2,"div")(3,"h1"),r(4,"Newsletter"),t(),n(5,"p"),r(6,"Manage scheduled and sent newsletters across the week."),t()(),n(7,"div",2)(8,"a",3),r(9,"Build Newsletter"),t(),n(10,"a",4),r(11,"View Analytics"),t()()(),n(12,"div",5)(13,"div",6)(14,"span"),r(15,"Subject"),t(),n(16,"span"),r(17,"Status"),t(),n(18,"span"),r(19,"Send Date"),t(),x(20,"span"),t(),g(21,le,10,9,"div",7),t()()),o&2&&(s(21),l("ngForOf",a.newsletters))},dependencies:[C,$,B],styles:[".newsletter[_ngcontent-%COMP%]{display:grid;gap:24px}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:16px}.actions[_ngcontent-%COMP%]{display:flex;gap:12px}.primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,var(--accent),var(--accent-strong));color:#fff;padding:8px 16px;border-radius:999px;text-decoration:none;box-shadow:var(--shadow)}.ghost[_ngcontent-%COMP%]{border:1px solid var(--border);padding:8px 16px;border-radius:999px;text-decoration:none;color:var(--text-primary);background:var(--surface-strong)}.table[_ngcontent-%COMP%]{border-radius:22px;border:1px solid var(--border);overflow:hidden;box-shadow:var(--shadow)}.table-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1fr 1fr auto;padding:12px 16px;align-items:center;background:var(--surface-strong);border-bottom:1px solid var(--border);transition:background .2s ease}.table-row[_ngcontent-%COMP%]:hover{background:var(--surface-muted)}.table-row.header[_ngcontent-%COMP%]{background:var(--surface-muted);font-weight:600;color:var(--text-secondary)}.table-row[_ngcontent-%COMP%]:last-child{border-bottom:none}@media (max-width: 720px){.table-row[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:6px}}"]})}}return i})();function pe(i,c){if(i&1&&(n(0,"option",10),r(1),t()),i&2){let e=c.$implicit;l("value",e.id),s(),b(" ",e.title," ")}}function ce(i,c){if(i&1&&(n(0,"option",10),r(1),t()),i&2){let e=c.$implicit;l("value",e.id),s(),b(" ",e.title," ")}}function me(i,c){if(i&1&&(n(0,"div",11)(1,"label"),r(2," Block Title "),x(3,"input",12),t(),n(4,"label"),r(5," Content Item "),n(6,"select",13)(7,"option",4),r(8,"Select content"),t(),g(9,ce,2,2,"option",5),t()()()),i&2){let e=c.index,o=y();l("formGroupName",e),s(9),l("ngForOf",o.contentOptions)}}var ie=(()=>{class i{constructor(e,o,a){this.fb=e,this.api=o,this.router=a,this.destroy$=new u,this.contentOptions=[],this.form=this.fb.group({subject:["",[_.required,_.minLength(6)]],heroContentId:["",_.required],blocks:this.fb.array([this.buildBlock(),this.buildBlock()])})}ngOnInit(){this.api.getContent({page:1,pageSize:12,sort:"publishDate:desc"}).pipe(m(this.destroy$)).subscribe(e=>this.contentOptions=e)}get blocks(){return this.form.controls.blocks}addBlock(){this.blocks.push(this.buildBlock())}save(){if(this.form.invalid){this.form.markAllAsTouched();return}let e=this.form.getRawValue(),o={subject:e.subject??"",heroContentId:e.heroContentId??"",blocks:e.blocks.map(a=>({title:a.title??"",contentId:a.contentId??""})),status:"scheduled",sendDate:new Date().toISOString()};this.api.createNewsletter(o).pipe(m(this.destroy$)).subscribe(()=>this.router.navigate(["/newsletter"]))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}buildBlock(){return this.fb.group({title:["",_.required],contentId:["",_.required]})}static{this.\u0275fac=function(o){return new(o||i)(p(X),p(v),p(A))}}static{this.\u0275cmp=f({type:i,selectors:[["app-newsletter-builder"]],standalone:!0,features:[h],decls:22,vars:3,consts:[[1,"builder"],[3,"ngSubmit","formGroup"],["type","text","formControlName","subject"],["formControlName","heroContentId"],["value",""],[3,"value",4,"ngFor","ngForOf"],["formArrayName","blocks",1,"blocks"],["class","block",3,"formGroupName",4,"ngFor","ngForOf"],["type","button",1,"ghost",3,"click"],["type","submit",1,"primary"],[3,"value"],[1,"block",3,"formGroupName"],["type","text","formControlName","title"],["formControlName","contentId"]],template:function(o,a){o&1&&(n(0,"section",0)(1,"header")(2,"h1"),r(3,"Newsletter Builder"),t(),n(4,"p"),r(5,"Create a scheduled email with hero content and modular blocks."),t()(),n(6,"form",1),S("ngSubmit",function(){return a.save()}),n(7,"label"),r(8," Subject Line "),x(9,"input",2),t(),n(10,"label"),r(11," Hero Pick "),n(12,"select",3)(13,"option",4),r(14,"Select content"),t(),g(15,pe,2,2,"option",5),t()(),n(16,"div",6),g(17,me,10,2,"div",7),t(),n(18,"button",8),S("click",function(){return a.addBlock()}),r(19,"Add Block"),t(),n(20,"button",9),r(21,"Save Newsletter"),t()()()),o&2&&(s(6),l("formGroup",a.form),s(9),l("ngForOf",a.contentOptions),s(2),l("ngForOf",a.blocks.controls))},dependencies:[Y,V,K,Q,L,J,G,U,z,W,q,H,C],styles:[".builder[_ngcontent-%COMP%]{display:grid;gap:20px;max-width:720px}form[_ngcontent-%COMP%]{display:grid;gap:16px;background:var(--surface-strong);padding:20px;border-radius:20px;border:1px solid var(--border)}label[_ngcontent-%COMP%]{display:grid;gap:6px;font-size:.85rem;color:var(--text-secondary)}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{border:1px solid var(--border);border-radius:12px;padding:10px 12px;background:var(--surface);color:var(--text-primary)}.blocks[_ngcontent-%COMP%]{display:grid;gap:12px}.block[_ngcontent-%COMP%]{display:grid;gap:12px;padding:12px;border-radius:16px;border:1px dashed var(--border)}.primary[_ngcontent-%COMP%]{background:var(--accent);color:#fff;border:none;padding:10px 16px;border-radius:999px}.ghost[_ngcontent-%COMP%]{border:1px solid var(--border);background:transparent;padding:10px 16px;border-radius:999px}"]})}}return i})();function ge(i,c){if(i&1&&(n(0,"div",7)(1,"span"),r(2),t(),n(3,"strong"),r(4),t()()),i&2){let e=c.$implicit,o=y(2);s(2),d(e.title),s(2),d(o.getContentTitle(e.contentId))}}function ue(i,c){if(i&1&&(n(0,"div",7)(1,"span"),r(2),t(),n(3,"strong"),r(4),t()()),i&2){let e=c.$implicit,o=y(2);s(2),d(e.title),s(2),d(o.getContentTitle(e.contentId))}}function fe(i,c){if(i&1&&(n(0,"section",1)(1,"header")(2,"h1"),r(3,"Newsletter Preview"),t(),n(4,"p"),r(5),t()(),n(6,"div",2)(7,"div",3)(8,"h3"),r(9),t(),n(10,"div",4)(11,"strong"),r(12,"Hero"),t(),n(13,"p"),r(14),t()(),g(15,ge,5,2,"div",5),t(),n(16,"div",6)(17,"h3"),r(18),t(),n(19,"div",4)(20,"strong"),r(21,"Hero"),t(),n(22,"p"),r(23),t()(),g(24,ue,5,2,"div",5),t()()()),i&2){let e=y();s(5),b("Desktop + mobile snapshots for ",e.newsletter.subject,""),s(4),d(e.newsletter.subject),s(5),d(e.getContentTitle(e.newsletter.heroContentId)),s(),l("ngForOf",e.newsletter.blocks),s(3),d(e.newsletter.subject),s(5),d(e.getContentTitle(e.newsletter.heroContentId)),s(),l("ngForOf",e.newsletter.blocks)}}var re=(()=>{class i{constructor(e,o){this.route=e,this.api=o,this.destroy$=new u,this.content=[]}ngOnInit(){let e=this.route.snapshot.paramMap.get("id")??"";P([this.api.getNewsletterById(e),this.api.getContent({page:1,pageSize:20,sort:"publishDate:desc"})]).pipe(m(this.destroy$)).subscribe(([o,a])=>{this.newsletter=o,this.content=a})}getContentTitle(e){return this.content.find(o=>o.id===e)?.title??"Untitled"}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static{this.\u0275fac=function(o){return new(o||i)(p(R),p(v))}}static{this.\u0275cmp=f({type:i,selectors:[["app-newsletter-preview"]],standalone:!0,features:[h],decls:1,vars:1,consts:[["class","preview",4,"ngIf"],[1,"preview"],[1,"frames"],[1,"frame","desktop"],[1,"hero"],["class","block",4,"ngFor","ngForOf"],[1,"frame","mobile"],[1,"block"]],template:function(o,a){o&1&&g(0,fe,25,7,"section",0),o&2&&l("ngIf",a.newsletter)},dependencies:[T,C],styles:[".preview[_ngcontent-%COMP%]{display:grid;gap:20px}.frames[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px}.frame[_ngcontent-%COMP%]{background:var(--surface-strong);border:1px solid var(--border);border-radius:20px;padding:16px;display:grid;gap:12px}.frame.desktop[_ngcontent-%COMP%]{min-height:420px}.frame.mobile[_ngcontent-%COMP%]{max-width:320px;justify-self:center}.hero[_ngcontent-%COMP%]{background:var(--accent-soft);padding:12px;border-radius:16px}.block[_ngcontent-%COMP%]{border-bottom:1px dashed var(--border);padding-bottom:10px}.block[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-secondary)}"]})}}return i})();var oe=(()=>{class i{constructor(){this.rawPoints=E([]),this.selectedRange=E(null),this.points=O(()=>{let e=this.selectedRange();if(!e)return this.rawPoints();let o=new Date(e.from).getTime(),a=new Date(e.to).getTime();return this.rawPoints().filter(w=>{let k=new Date(w.date).getTime();return k>=o&&k<=a})}),this.average=O(()=>{let e=this.points();if(!e.length)return 0;let o=e.reduce((a,w)=>a+w.value,0);return Math.round(o/e.length*10)/10})}setPoints(e){this.rawPoints.set(e)}setRange(e){this.selectedRange.set(e)}static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275prov=I({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var ae=(()=>{class i{constructor(e,o,a){this.api=e,this.state=o,this.store=a,this.destroy$=new u,this.ranges=this.getRanges(),this.selectedRange=this.ranges[0],this.points=this.store.points,this.average=this.store.average,this.avgLabel=O(()=>`${this.average()}% avg open rate`)}ngOnInit(){this.state.dateRange$.pipe(m(this.destroy$)).subscribe(e=>{this.selectedRange=e,this.store.setRange(e)}),this.api.getAnalytics(this.selectedRange.from,this.selectedRange.to).pipe(m(this.destroy$)).subscribe(e=>this.store.setPoints(e.newsletter))}setRange(e){this.state.setDateRange(e)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}getRanges(){let e=new Date;return[7,30,90].map(o=>{let a=new Date;return a.setDate(e.getDate()-o),{label:`Last ${o} days`,from:a.toISOString(),to:e.toISOString()}})}static{this.\u0275fac=function(o){return new(o||i)(p(v),p(te),p(oe))}}static{this.\u0275cmp=f({type:i,selectors:[["app-newsletter-analytics"]],standalone:!0,features:[h],decls:25,vars:5,consts:[[1,"analytics"],[1,"header"],[3,"select","options","selected"],[1,"summary"],[1,"panel"],[3,"points"]],template:function(o,a){o&1&&(n(0,"section",0)(1,"header",1)(2,"div")(3,"h1"),r(4,"Newsletter Analytics"),t(),n(5,"p"),r(6,"Signals-driven insights for newsletter performance."),t()(),n(7,"app-date-range-selector",2),S("select",function(k){return a.setRange(k)}),t()(),n(8,"div",3)(9,"div")(10,"h3"),r(11,"Average Opens"),t(),n(12,"strong"),r(13),t(),n(14,"p"),r(15),t()(),n(16,"div")(17,"h3"),r(18,"Top Day"),t(),n(19,"strong"),r(20,"Wednesday"),t(),n(21,"p"),r(22,"Peak opens at 10:00"),t()()(),n(23,"div",4),x(24,"app-mini-line-chart",5),t()()),o&2&&(s(7),l("options",a.ranges)("selected",a.selectedRange),s(6),b("",a.average(),"%"),s(2),d(a.avgLabel()),s(9),l("points",a.points()))},dependencies:[Z,ee],styles:[".analytics[_ngcontent-%COMP%]{display:grid;gap:24px}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:16px;flex-wrap:wrap}.summary[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px}.summary[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{background:var(--surface-strong);border-radius:22px;padding:18px;border:1px solid var(--border);box-shadow:var(--shadow)}.summary[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-secondary)}.panel[_ngcontent-%COMP%]{background:var(--surface-strong);border-radius:22px;padding:18px;border:1px solid var(--border);box-shadow:var(--shadow)}"]})}}return i})();var Ue=[{path:"",component:ne},{path:"builder",component:ie},{path:"preview/:id",component:re},{path:"analytics",component:ae}];export{Ue as NEWSLETTER_ROUTES};
